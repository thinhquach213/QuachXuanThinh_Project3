<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8"/>
    <title>Book Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
</head>
<body style="background:#eee">
<section class="container my-4 bg-white p-3">
    <h2 th:text="${book.id != null} ? 'Edit Book' : 'Create Book'">Book Form</h2>
    <form th:action="@{/books/new}" th:object="${book}" method="post" enctype="multipart/form-data">
        <input type="hidden" th:if="${book.id != null}" th:value="${book.id}" name="id"/>
        <div class="mb-3">
            <label>Code</label>
            <input class="form-control" th:field="*{code}" />
        </div>
        <div class="mb-3">
            <label>Name</label>
            <input class="form-control" th:field="*{name}" />
        </div>
        <div class="mb-3">
            <label>Image</label>
            <input type="file" name="imageFile" class="form-control"/>
            <input type="hidden" th:field="*{imgUrl}" />
            <div th:if="${book.imgUrl}">
                <img th:src="${book.imgUrl}" style="width:80px;height:80px"/>
            </div>
        </div>
        <div class="mb-3">
            <label>Description</label>
            <textarea class="form-control" th:field="*{description}"></textarea>
        </div>
        <div class="mb-3">
            <label>Quantity</label>
            <input type="number" class="form-control" th:field="*{quantity}" />
        </div>
        <div class="mb-3">
            <label>Price</label>
            <input type="number" step="0.01" class="form-control" th:field="*{price}" />
        </div>

        <div class="mb-3">
            <label>Authors</label>
            <div th:each="author,iter : ${authors}">
                <input type="checkbox" name="authorIds" th:value="${author.id}" th:id="${'chk_'+author.id}" th:checked="${#lists.contains(book.bookAuthors.?[author.id==author.id], true) ? 'checked' : null}" class="authorChk"/>
                <label th:for="${'chk_'+author.id}" th:text="${author.name}">Author</label>
                <input type="radio" name="editorId" th:value="${author.id}" class="editorRadio" disabled/> Chủ biên
                <br/>
            </div>
        </div>

        <div class="mb-3">
            <label>Active</label>
            <input type="checkbox" th:field="*{isActive}" />
        </div>

        <button class="btn btn-primary">Save</button>
        <a th:href="@{/books}" class="btn btn-secondary">Back</a>
    </form>
</section>

<script>
    // enable radio only if checkbox checked
    document.addEventListener('DOMContentLoaded', function() {
        const chks = document.querySelectorAll('.authorChk');
        chks.forEach(function(cb){
            cb.addEventListener('change', function(){
                const id = cb.value;
                const radio = document.querySelector('input.editorRadio[value="' + id + '"]');
                if(radio) radio.disabled = !cb.checked;
                if(!cb.checked && radio) radio.checked = false;
            });
        });
    });
</script>
</body>
</html>
