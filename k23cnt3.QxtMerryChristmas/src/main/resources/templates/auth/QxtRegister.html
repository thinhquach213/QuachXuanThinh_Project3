<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ğŸ„ ÄÄƒng KÃ½ - Merry Chismart</title>
    <link rel="stylesheet" th:href="@{/css/qxt-style.css}">
</head>
<body class="register-page">

<!-- HEADER -->
<th:block th:replace="~{layout/qxtHeader :: qxt_header}"></th:block>

<div class="auth-wrapper">
    <div class="auth-container">
        <!-- TiÃªu Ä‘á» vá»›i hÃ¬nh áº£nh Noel -->
        <div class="auth-header">
            <div class="noel-icon">ğŸ</div>
            <h1>ÄÄƒng KÃ½ Merry Chismart</h1>
            <p class="auth-subtitle">Táº¡o tÃ i khoáº£n Ä‘á»ƒ nháº­n Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t mÃ¹a Noel</p>
        </div>

        <!-- THÃ”NG BÃO Lá»–I -->
        <div th:if="${error}" class="auth-error" th:text="${error}"></div>
        <div th:if="${success}" class="auth-success" th:text="${success}"></div>

        <form th:action="@{/register}" method="post" onsubmit="return validateRegisterForm()" class="auth-form">

            <!-- GIá»® Láº I URL QUAY Vá»€ -->
            <input type="hidden" name="redirect" th:value="${redirect}">

            <div class="form-group">
                <label for="fullName">ğŸ‘¤ Há» tÃªn *</label>
                <input type="text" name="fullName" id="fullName"
                       placeholder="Nháº­p há» tÃªn cá»§a báº¡n" value=""
                       required>
                <div class="form-hint">TÃªn sáº½ hiá»ƒn thá»‹ trÃªn tÃ i khoáº£n vÃ  Ä‘Æ¡n hÃ ng</div>
            </div>

            <div class="form-group">
                <label for="regEmail">ğŸ“§ Email *</label>
                <input type="email" name="email" id="regEmail"
                       placeholder="Nháº­p email cá»§a báº¡n" value=""
                       required>
                <div class="form-hint">Email dÃ¹ng Ä‘á»ƒ Ä‘Äƒng nháº­p vÃ  nháº­n thÃ´ng bÃ¡o</div>
            </div>

            <div class="form-group">
                <label for="regPassword">ğŸ”’ Máº­t kháº©u *</label>
                <div class="password-wrapper">
                    <input type="password" name="password" id="regPassword"
                           placeholder="Nháº­p máº­t kháº©u (Ã­t nháº¥t 6 kÃ½ tá»±)" required>
                    <button type="button" class="toggle-pass" onclick="togglePassword('regPassword')">
                        ğŸ‘ï¸
                    </button>
                </div>
                <div class="password-strength">
                    <div class="strength-bar"></div>
                    <span class="strength-text">Äá»™ máº¡nh máº­t kháº©u: <span id="strengthLabel">Yáº¿u</span></span>
                </div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">âœ… XÃ¡c nháº­n máº­t kháº©u *</label>
                <div class="password-wrapper">
                    <input type="password" id="confirmPassword"
                           placeholder="Nháº­p láº¡i máº­t kháº©u" required>
                    <button type="button" class="toggle-pass" onclick="togglePassword('confirmPassword')">
                        ğŸ‘ï¸
                    </button>
                </div>
                <div id="passwordMatch" class="form-hint"></div>
            </div>

            <div class="form-group">
                <label for="phone">ğŸ“± Sá»‘ Ä‘iá»‡n thoáº¡i</label>
                <input type="tel" name="phone" id="phone"
                       placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i (10-11 sá»‘)" value="">
                <div class="form-hint">Äá»ƒ nháº­n thÃ´ng bÃ¡o vá» Ä‘Æ¡n hÃ ng vÃ  khuyáº¿n mÃ£i</div>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="agreeTerms" required>
                    <span>TÃ´i Ä‘á»“ng Ã½ vá»›i <a href="/terms" target="_blank">Äiá»u khoáº£n sá»­ dá»¥ng</a>
                    vÃ  <a href="/privacy" target="_blank">ChÃ­nh sÃ¡ch báº£o máº­t</a> cá»§a Merry Chismart</span>
                </label>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="newsletter" checked>
                    <span>ÄÄƒng kÃ½ nháº­n báº£n tin khuyáº¿n mÃ£i Noel vÃ  Ã½ tÆ°á»Ÿng trang trÃ­</span>
                </label>
            </div>

            <button type="submit" class="auth-btn">ğŸ… Táº¡o TÃ i Khoáº£n</button>

            <div class="auth-divider">
                <span>Hoáº·c Ä‘Äƒng kÃ½ vá»›i</span>
            </div>

            <div class="social-login">
                <button type="button" class="social-btn facebook">
                    <span>ğŸ“˜ Facebook</span>
                </button>
                <button type="button" class="social-btn google">
                    <span>ğŸ”µ Google</span>
                </button>
            </div>
        </form>

        <div class="auth-switch">
            <p>ğŸ„ ÄÃ£ cÃ³ tÃ i khoáº£n Merry Chismart?</p>
            <a th:href="@{/login(redirect=${redirect})}" class="login-link">âœ¨ ÄÄƒng nháº­p ngay</a>
        </div>

        <div class="auth-benefits">
            <h3>ğŸ Lá»£i Ã­ch khi Ä‘Äƒng kÃ½ thÃ nh viÃªn:</h3>
            <ul>
                <li>âœ… Nháº­n ngay <strong>voucher 50K</strong> cho Ä‘Æ¡n hÃ ng Ä‘áº§u tiÃªn</li>
                <li>âœ… TÃ­ch lÅ©y Ä‘iá»ƒm Ä‘á»•i quÃ  Noel Ä‘áº·c biá»‡t</li>
                <li>âœ… Æ¯u tiÃªn nháº­n thÃ´ng bÃ¡o khuyáº¿n mÃ£i sá»›m nháº¥t</li>
                <li>âœ… Lá»‹ch sá»­ mua hÃ ng & theo dÃµi Ä‘Æ¡n dá»… dÃ ng</li>
                <li>âœ… ÄÆ°á»£c tÆ° váº¥n trang trÃ­ miá»…n phÃ­ 24/7</li>
                <li>âœ… Giáº£m thÃªm 5% cho thÃ nh viÃªn thÃ¢n thiáº¿t</li>
            </ul>
        </div>
    </div>
</div>

<script>
    // Kiá»ƒm tra form trÆ°á»›c khi submit
    function validateRegisterForm() {
        const fullName = document.getElementById('fullName');
        const email = document.getElementById('regEmail');
        const password = document.getElementById('regPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const phone = document.getElementById('phone');
        const agreeTerms = document.getElementById('agreeTerms');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const phoneRegex = /^(0[3|5|7|8|9])+([0-9]{8,9})$/;

        if (!fullName.value.trim()) {
            alert('ğŸ… Vui lÃ²ng nháº­p há» tÃªn cá»§a báº¡n');
            fullName.focus();
            return false;
        }

        if (!email.value.trim()) {
            alert('ğŸ… Vui lÃ²ng nháº­p email');
            email.focus();
            return false;
        }

        if (!emailRegex.test(email.value)) {
            alert('ğŸ… Email khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng. Vui lÃ²ng kiá»ƒm tra láº¡i.');
            email.focus();
            return false;
        }

        if (!password.value.trim()) {
            alert('ğŸ… Vui lÃ²ng nháº­p máº­t kháº©u');
            password.focus();
            return false;
        }

        if (password.value.length < 6) {
            alert('ğŸ… Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±');
            password.focus();
            return false;
        }

        if (password.value !== confirmPassword.value) {
            alert('ğŸ… Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p. Vui lÃ²ng kiá»ƒm tra láº¡i.');
            confirmPassword.focus();
            return false;
        }

        if (phone.value.trim() && !phoneRegex.test(phone.value)) {
            alert('ğŸ… Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng. Vui lÃ²ng kiá»ƒm tra láº¡i.');
            phone.focus();
            return false;
        }

        if (!agreeTerms.checked) {
            alert('ğŸ… Vui lÃ²ng Ä‘á»“ng Ã½ vá»›i Äiá»u khoáº£n sá»­ dá»¥ng vÃ  ChÃ­nh sÃ¡ch báº£o máº­t');
            agreeTerms.focus();
            return false;
        }

        return true;
    }

    // Toggle show/hide password
    function togglePassword(id) {
        const passInput = document.getElementById(id);
        const toggleBtn = passInput.nextElementSibling;

        if (passInput.type === 'password') {
            passInput.type = 'text';
            toggleBtn.textContent = 'ğŸ‘ï¸â€ğŸ—¨ï¸';
        } else {
            passInput.type = 'password';
            toggleBtn.textContent = 'ğŸ‘ï¸';
        }
    }

    // Kiá»ƒm tra Ä‘á»™ máº¡nh máº­t kháº©u
    function checkPasswordStrength(password) {
        let strength = 0;
        const strengthBar = document.querySelector('.strength-bar');
        const strengthLabel = document.getElementById('strengthLabel');

        if (password.length >= 6) strength++;
        if (password.length >= 8) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        // Cáº­p nháº­t thanh Ä‘á»™ máº¡nh
        const width = (strength / 5) * 100;
        strengthBar.style.width = width + '%';

        // Cáº­p nháº­t mÃ u vÃ  nhÃ£n
        if (strength <= 2) {
            strengthBar.style.background = '#ff4444';
            strengthLabel.textContent = 'Yáº¿u';
            strengthLabel.style.color = '#ff4444';
        } else if (strength <= 3) {
            strengthBar.style.background = '#ff9800';
            strengthLabel.textContent = 'Trung bÃ¬nh';
            strengthLabel.style.color = '#ff9800';
        } else if (strength <= 4) {
            strengthBar.style.background = '#4caf50';
            strengthLabel.textContent = 'Máº¡nh';
            strengthLabel.style.color = '#4caf50';
        } else {
            strengthBar.style.background = '#2e7d32';
            strengthLabel.textContent = 'Ráº¥t máº¡nh';
            strengthLabel.style.color = '#2e7d32';
        }
    }

    // Kiá»ƒm tra máº­t kháº©u trÃ¹ng khá»›p
    function checkPasswordMatch() {
        const password = document.getElementById('regPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const matchDiv = document.getElementById('passwordMatch');

        if (!confirmPassword) {
            matchDiv.textContent = '';
            return;
        }

        if (password === confirmPassword) {
            matchDiv.textContent = 'âœ… Máº­t kháº©u trÃ¹ng khá»›p';
            matchDiv.style.color = '#4caf50';
        } else {
            matchDiv.textContent = 'âŒ Máº­t kháº©u khÃ´ng khá»›p';
            matchDiv.style.color = '#ff4444';
        }
    }

    // Gáº¯n sá»± kiá»‡n cho cÃ¡c input
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('regPassword');
        const confirmInput = document.getElementById('confirmPassword');
        const fullNameInput = document.getElementById('fullName');

        if (passwordInput) {
            passwordInput.addEventListener('input', function() {
                checkPasswordStrength(this.value);
                checkPasswordMatch();
            });
        }

        if (confirmInput) {
            confirmInput.addEventListener('input', checkPasswordMatch);
        }

        if (fullNameInput) {
            fullNameInput.focus();
        }
    });
</script>

</body>
</html>